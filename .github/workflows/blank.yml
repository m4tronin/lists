name: Update community.txt

on:
  schedule:
    - cron: '0 0 * * *'
  workflow_dispatch:

permissions:
  contents: write

jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: –°–∫–∞—á–∞—Ç—å community.lst
        run: |
          curl -Lfs https://raw.githubusercontent.com/1andrevich/Re-filter-lists/main/community.lst -o community.txt
          echo "‚úÖ –§–∞–π–ª —Å–∫–∞—á–∞–Ω:"
          ls -la community.txt
          echo "–ü–µ—Ä–≤—ã–µ 5 —Å—Ç—Ä–æ–∫:"
          head -5 community.txt
      
      - name: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏ –∫–æ–º–º–∏—Ç
        run: |
          git config user.name "Update Bot"
          git config user.email "action@github.com"
          
          echo "üîç –°—Ç–∞—Ç—É—Å –¥–æ git diff:"
          git status
          
          if git diff --quiet community.txt; then
            echo "‚ùå –§–∞–π–ª –Ω–µ –∏–∑–º–µ–Ω–∏–ª—Å—è (–≤–æ–∑–º–æ–∂–Ω–æ, —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)"
          else
            echo "‚úÖ –ï—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è, –¥–µ–ª–∞–µ–º –∫–æ–º–º–∏—Ç"
            git add community.txt
            git commit -m "–û–±–Ω–æ–≤–∏—Ç—å community.txt [$(date +'%Y-%m-%d')]"
            git push
            echo "‚úÖ –ü—É—à —É—Å–ø–µ—à–µ–Ω"
          fi
